<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hyu.property.mapper.FeeTypeMapper">

    <resultMap type="FeeType" id="FeeTypeResult">
        <result property="id" column="id" />
        <result property="typeName" column="type_name" />
        <result property="typeCode" column="type_code" />
        <result property="unitPrice" column="unit_price" />
        <result property="billingUnit" column="billing_unit" />
        <result property="billingCycle" column="billing_cycle" />
        <result property="description" column="description" />
        <result property="status" column="status" />
        <result property="createBy" column="create_by" />
        <result property="createTime" column="create_time" />
        <result property="updateBy" column="update_by" />
        <result property="updateTime" column="update_time" />
    </resultMap>

    <sql id="selectFeeTypeVo">
        select id, type_name, type_code, unit_price, billing_unit, billing_cycle, description, status, create_by, create_time, update_by, update_time from fee_type
    </sql>

    <select id="selectFeeTypePage" parameterType="FeeType" resultMap="FeeTypeResult">
        <include refid="selectFeeTypeVo"/>
        <where>
            deleted = 0
            <if test="feeName != null and feeName != ''">
                AND type_name LIKE CONCAT('%', #{feeName}, '%')
            </if>
            <if test="feeCode != null and feeCode != ''">
                AND type_code LIKE CONCAT('%', #{feeCode}, '%')
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>

    <select id="selectFeeTypeList" parameterType="FeeType" resultMap="FeeTypeResult">
        <include refid="selectFeeTypeVo"/>
        <where>
            deleted = 0
            <if test="feeName != null and feeName != ''">
                AND type_name LIKE CONCAT('%', #{feeName}, '%')
            </if>
            <if test="feeCode != null and feeCode != ''">
                AND type_code LIKE CONCAT('%', #{feeCode}, '%')
            </if>
            <if test="status != null">
                AND status = #{status}
            </if>
        </where>
        ORDER BY create_time DESC
    </select>

    <select id="selectFeeTypeAll" resultMap="FeeTypeResult">
        <include refid="selectFeeTypeVo"/>
        WHERE deleted = 0 AND status = 1
        ORDER BY id ASC
    </select>

    <select id="selectFeeTypeById" parameterType="Long" resultMap="FeeTypeResult">
        <include refid="selectFeeTypeVo"/>
        WHERE id = #{feeTypeId} AND deleted = 0
    </select>

    <select id="checkFeeCodeUnique" parameterType="FeeType" resultMap="FeeTypeResult">
        <include refid="selectFeeTypeVo"/>
        WHERE type_code = #{typeCode} AND deleted = 0
        <if test="id != null">
            AND id != #{id}
        </if>
        LIMIT 1
    </select>

    <select id="checkFeeTypeExistBill" parameterType="Long" resultType="boolean">
        SELECT COUNT(1) > 0
        FROM bill
        WHERE fee_type_id = #{feeTypeId} AND deleted = 0
        LIMIT 1
    </select>

    <insert id="insertFeeType" parameterType="FeeType" useGeneratedKeys="true" keyProperty="id">
        insert into fee_type
        <trim prefix="(" suffix=")" suffixOverrides=",">
            <if test="feeName != null and feeName != ''">type_name,</if>
            <if test="feeCode != null and feeCode != ''">type_code,</if>
            <if test="unitPrice != null">unit_price,</if>
            <if test="unitType != null">billing_unit,</if>
            <if test="billingCycle != null">billing_cycle,</if>
            <if test="description != null">description,</if>
            <if test="status != null">status,</if>
            <if test="createBy != null">create_by,</if>
            create_time
        </trim>
        <trim prefix="values (" suffix=")" suffixOverrides=",">
            <if test="feeName != null and feeName != ''">#{feeName},</if>
            <if test="feeCode != null and feeCode != ''">#{feeCode},</if>
            <if test="unitPrice != null">#{unitPrice},</if>
            <if test="unitType != null">#{unitType},</if>
            <if test="billingCycle != null">#{billingCycle},</if>
            <if test="description != null">#{description},</if>
            <if test="status != null">#{status},</if>
            <if test="createBy != null">#{createBy},</if>
            sysdate()
        </trim>
    </insert>

    <update id="updateFeeType" parameterType="FeeType">
        update fee_type
        <trim prefix="SET" suffixOverrides=",">
            <if test="feeName != null and feeName != ''">type_name = #{feeName},</if>
            <if test="feeCode != null and feeCode != ''">type_code = #{feeCode},</if>
            <if test="unitPrice != null">unit_price = #{unitPrice},</if>
            <if test="unitType != null">billing_unit = #{unitType},</if>
            <if test="billingCycle != null">billing_cycle = #{billingCycle},</if>
            <if test="description != null">description = #{description},</if>
            <if test="status != null">status = #{status},</if>
            <if test="updateBy != null">update_by = #{updateBy},</if>
            update_time = sysdate()
        </trim>
        where id = #{id}
    </update>

    <delete id="deleteFeeTypeByIds" parameterType="String">
        update fee_type set deleted = 1, update_time = sysdate()
        where id in
        <foreach item="feeTypeId" collection="array" open="(" separator="," close=")">
            #{feeTypeId}
        </foreach>
    </delete>

</mapper>